import os
import numpy as np
from pople import au2kcm, kcm2au, kB, j2au, au2cmi
from pople import dH_atoms
from pople import getatoms, uniqatoms, HLC_g4mp2, thermal

def strip_geom(geom):
    geom_line=geom.strip().split()

    charge=int(geom_line[0])
    geom_line.pop(0)

    multip=int(geom_line[0])
    geom_line.pop(0)

    Nat = int((len(geom_line))/4)
    isatom = 'false'
    if Nat == 1:
        isatom = 'true'

    sym=[]
    for iat in range(0,len(geom_line),4):
        sym.append(geom_line[iat])

    return charge, multip, Nat, isatom, sym

geom = '''
 0      1
 C      3.4826383267   0.6912266135   0.0000000000
 C      3.4826383267  -0.6912266135   0.0000000000
 C     -3.4826383267   0.6912266135   0.0000000000
 C     -3.4826383267  -0.6912266135   0.0000000000
 C      0.6912266135   0.0000000000   3.4826383267
 C     -0.6912266135   0.0000000000   3.4826383267
 C      0.6912266135   0.0000000000  -3.4826383267
 C     -0.6912266135   0.0000000000  -3.4826383267
 C      0.0000000000   3.4826383267   0.6912266135
 C      0.0000000000   3.4826383267  -0.6912266135
 C      0.0000000000  -3.4826383267   0.6912266135
 C      0.0000000000  -3.4826383267  -0.6912266135
 C      3.0311143619   1.4218077350   1.1821050862
 C      3.0311143619   1.4218077350  -1.1821050862
 C      3.0311143619  -1.4218077350   1.1821050862
 C      3.0311143619  -1.4218077350  -1.1821050862
 C     -3.0311143619   1.4218077350   1.1821050862
 C     -3.0311143619   1.4218077350  -1.1821050862
 C     -3.0311143619  -1.4218077350   1.1821050862
 C     -3.0311143619  -1.4218077350  -1.1821050862
 C      1.4218077350   1.1821050862   3.0311143619
 C      1.4218077350  -1.1821050862   3.0311143619
 C     -1.4218077350   1.1821050862   3.0311143619
 C     -1.4218077350  -1.1821050862   3.0311143619
 C      1.4218077350   1.1821050862  -3.0311143619
 C      1.4218077350  -1.1821050862  -3.0311143619
 C     -1.4218077350   1.1821050862  -3.0311143619
 C     -1.4218077350  -1.1821050862  -3.0311143619
 C      1.1821050862   3.0311143619   1.4218077350
 C     -1.1821050862   3.0311143619   1.4218077350
 C      1.1821050862   3.0311143619  -1.4218077350
 C     -1.1821050862   3.0311143619  -1.4218077350
 C      1.1821050862  -3.0311143619   1.4218077350
 C     -1.1821050862  -3.0311143619   1.4218077350
 C      1.1821050862  -3.0311143619  -1.4218077350
 C     -1.1821050862  -3.0311143619  -1.4218077350
 C      2.6039128211   0.73058120.4   2.3005332405
 C      2.6039128211   0.73058120.4  -2.3005332405
 C      2.6039128211  -0.73058120.4   2.3005332405
 C      2.6039128211  -0.73058120.4  -2.3005332405
 C     -2.6039128211   0.73058120.4   2.3005332405
 C     -2.6039128211   0.73058120.4  -2.3005332405
 C     -2.6039128211  -0.73058120.4   2.3005332405
 C     -2.6039128211  -0.73058120.4  -2.3005332405
 C      0.73058120.4   2.3005332405   2.6039128211
 C      0.73058120.4  -2.3005332405   2.6039128211
 C     -0.73058120.4   2.3005332405   2.6039128211
 C     -0.73058120.4  -2.3005332405   2.6039128211
 C      0.73058120.4   2.3005332405  -2.6039128211
 C      0.73058120.4  -2.3005332405  -2.6039128211
 C     -0.73058120.4   2.3005332405  -2.6039128211
 C     -0.73058120.4  -2.3005332405  -2.6039128211
 C      2.3005332405   2.6039128211   0.73058120.4
 C     -2.3005332405   2.6039128211   0.73058120.4
 C      2.3005332405   2.6039128211  -0.73058120.4
 C     -2.3005332405   2.6039128211  -0.73058120.4
 C      2.3005332405  -2.6039128211   0.73058120.4
 C     -2.3005332405  -2.6039128211   0.73058120.4
 C      2.3005332405  -2.6039128211  -0.73058120.4
 C     -2.3005332405  -2.6039128211  -0.73058120.4
'''

freq ='''
265.26
265.26
265.27
265.27
265.27
338.84
338.84
338.84
360.90
360.90
360.90
360.91
407.48
407.48
407.49
407.49
407.49
435.44
435.44
435.44
435.47
435.47
491.31
491.31
491.31
491.36
492.08
532.65
532.65
532.65
543.48
543.48
543.51
543.51
543.51
567.31
567.31
567.31
570.46
570.46
570.46
576.96
576.96
576.96
576.97
582.14
582.14
582.14
678.84
678.84
678.84
678.86
678.86
721.13
721.13
721.13
721.13
721.13
723.78
723.78
723.78
744.88
744.88
744.90
744.90
744.90
747.80
747.80
747.80
756.14
756.14
756.14
756.16
759.54
759.54
759.54
759.57
768.30
768.30
768.30
768.32
777.75
777.75
777.75
777.76
777.76
800.03
800.03
800.03
838.71
838.71
838.71
955.11
955.11
955.11
968.96
969.44
969.44
969.44
969.44
1067.66
1067.67
1067.67
1067.67
1104.15
1104.15
1104.15
1104.16
1104.16
1168.48
1168.48
1168.48
1182.40
1182.40
1182.40
1216.43
1216.43
1216.43
1216.44
1216.44
1242.33
1242.33
1242.35
1242.35
1242.35
1272.20
1272.20
1272.20
1308.20
1308.20
1308.20
1308.22
1315.16
1315.16
1315.16
1315.17
1329.38
1329.38
1329.38
1334.02
1334.02
1334.02
1334.03
1334.03
1458.59
1458.59
1458.59
1458.59
1458.59
1458.89
1458.89
1458.89
1458.90
1470.26
1470.26
1470.26
1512.90
1543.54
1543.54
1543.54
1543.54
1583.87
1583.87
1583.87
1614.24
1614.24
1614.24
1614.24
1614.24
1625.75
1625.75
1625.75
1625.75
1625.75
'''
#=== HLC
HLC_params = [ 9.51842, 3.19566, 9.80448, 2.05800, 9.79309, 2.38393 ]

#=== Constants
T = 298.15
kBT = kB * T * j2au

scal = 0.9854

#=== C60
charge, multip, Nat_mol, isatom, sym = strip_geom(geom)

dE_HLC = HLC_g4mp2(charge, multip, sym, isatom, HLC_params)

freq_line=freq.strip().split()

freq=[]
for ifreq in range(0,len(freq_line)):
    freq.append(freq_line[ifreq])

dE_ZPE_mol, dE_vib, dE_rot, dE_tra, dE_thermal = thermal(isatom, freq, scal, 'NL', T)

#=== G4MP2-XP energies
E_CC       = -2279.811278
dE_MP2     =    -2.159367
dE_HF      =    -0.197475
dE_SO      =     0.0

U0_mol = E_CC + dE_MP2 + dE_HF + dE_SO + dE_HLC + dE_ZPE_mol
UT_mol = U0_mol + dE_thermal
HT_mol = UT_mol + kBT
geom_mol = geom

#=== C
geom = '''
0   3
C   0.0  0.0  0.0
'''

charge, multip, Nat, isatom, sym = strip_geom(geom)

dE_HLC = HLC_g4mp2(charge, multip, sym, isatom, HLC_params)

freq =[]

dE_ZPE, dE_vib, dE_rot, dE_tra, dE_thermal = thermal(isatom, freq, scal, 'NL', T)

#=== G4MP2-XP energies
E_CC       = -37.751205
dE_MP2     =  -0.025414
dE_HF      =  -0.003477
dE_SO      =  -0.000140

U0_C = E_CC + dE_MP2 + dE_HF + dE_SO + dE_HLC + dE_ZPE
UT_C = U0_C + dE_thermal 
HT_C = UT_C + kBT

#=== Atomization energy and formation enthalpy
U0molAE = (Nat_mol * U0_C - U0_mol )

print('\n')
print(' Atomization energy is {:20.4f} hartree'.format(U0molAE) )
print(' Atomization energy is {:20.4f} kcal/mol'.format(U0molAE*au2kcm) )

print('\n')
print(' ZPVE is               {:20.4f} kcal/mol'.format(dE_ZPE_mol*au2kcm) )

C_prms=[ 169.98, 170.027, 170.11 ]

print('\n')
print('             HOF_atoms(C)       HOF molecule  [all in kcal/mol]')

dH_298K_0K = dH_atoms('C')

for C in C_prms:
    HOF_0K = C*kcm2au
    HT_form = 60 * ( HOF_0K - dH_298K_0K )
    HT_form = HT_form + (HT_mol - U0_mol) - U0molAE
    print(' {:20.4f}{:20.4f}'.format(C, HT_form*au2kcm))
print('')
